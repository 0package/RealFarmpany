# API 명세서 작성

날짜: 2025년 2월 26일
선택: API

### 로그인 페이지

**[GET /login]**

- **설명:**
    - 클라이언트가 로그인 페이지(`login.html`)를 요청하는 엔드포인트입니다. 주로 웹 브라우저에서 로그인 화면을 표시하는 데 사용됩니다.
- **응답:** HTML 페이지

---

### 아이디 중복 확인

**[GET /check-userid]**

- **설명:**
    - 사용자가 입력한 아이디(user_id)가 이미 존재하는지 확인합니다.
- **요청 파라미터:**
    - `user_id`: 중복 확인할 사용자 이메일

---

### 닉네임 중복 확인

**[GET /check-username]**

- **설명:**
    - 사용자가 입력한 닉네임(username)이 이미 존재하는지 확인합니다.
- **요청 파라미터:**
    - `username`: 중복 확인할 사용자 닉네임

---

### 3. 회원가입

**[POST /signup]**

- **설명:**
    - 사용자가 새로운 계정을 생성하는 엔드포인트입니다. 이메일(user_id), 비밀번호(password), 사용자 이름(username)을 받아 회원가입을 처리합니다.
- **요청 파라미터:**
    - `user_id`: 회원가입할 ID
    - `password`:  회원가입할 비밀번호
    - `username`:  회원가입할 닉네임

---

### 로그인

**[POST /login]**

- **설명:**
    - 사용자가 기존 계정으로 로그인하는 엔드포인트입니다. 이메일과 비밀번호를 확인하여 인증을 진행합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `password`: 비밀번호

---

### 최근 센서 데이터 조회

**[GET /sensors/status]**

- **설명:**
    - 특정 사용자와 농장에 대한 최신 센서 데이터를 조회합니다. 온도, 습도, 토양 수분 등의 정보를 반환합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        {
          "temperature": 22.25,
          "humidity": 75.40,
          "soil_moisture": 50.32,
          "created_at": "2025-02-25T10:00:00Z"
        }
        ```
        

---

### 센서 데이터 저장

**[POST /sensors]**

- **설명:**
    
    센서 데이터를 DB에 저장하고, 방금 저장한 데이터를 다시 조회하여 확인합니다.
    
    저장된 데이터를 기반으로 장치 제어 로직도 실행합니다.
    
- **요청 본문:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `temperature`: 온도 (°C)
    - `humidity`: 습도 (%)
    - `soil_moisture`: 토양 수분 (%)
    - `co2`: CO2 농도 (ppm)
    - `created_at`: 데이터 생성 시간 (선택 사항, 미입력 시 현재 시간 저장)
- **응답:**

---

### 센서 데이터 저장 (온도, 습도, 토양 수분)

**[POST /sensors]**

- **설명:**
    - 센서에서 수집된 데이터를 저장하는 엔드포인트입니다. 온도, 습도, 토양 수분 값을 수집하여 DB에 저장합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `temperature`: 온도
    - `humidity`: 습도
    - `soil_moisture`: 토양 수분

---

### 제어장치 상태 가져오기

**[GET /devices/status]**

- **설명:**
    - 특정 농장에 있는 제어장치들(LED, 팬, 물 공급)의 상태를 조회하는 엔드포인트입니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        {
          "led": true,
          "fan": false,
          "water": true,
          "heater": false,
          "cooler": false
        }
        ```
        

---

### 제어장치 상태 변경하기

**[POST /devices/status]**

- **설명:**
    - 농장의 제어장치(LED, 팬, 물 공급)의 상태를 변경하는 엔드포인트입니다. 각 장치를 켜거나 끌 수 있습니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `device`: 장치 타입 (`led`, `fan`, `water`)

---

### 농장 목록 불러오기

**[GET /getFarms]**

- **설명:**
    - 사용자가 보유한 농장의 목록을 불러오는 엔드포인트입니다. 농장의 ID와 이름이 반환됩니다.
- **요청 파라미터:**
    - `userId`: 사용자 이메일
- **응답**
    - 성공 `200`
        
        ```json
        {
        
        }
        ```
        

---

### 농장 추가하기

**[POST /addFarm]**

- **설명:**
    - 사용자가 새로운 농장을 추가하는 엔드포인트입니다. 농장 이름을 받아서 새로운 농장을 등록합니다.
- **요청 파라미터:**
    - `userId`: 사용자 이메일
- **응답**
    - 성공 `200`
        
        ```json
        {
          "success": true,
          "farm_id": 1
        }
        ```
        
    
    ---
    
    ### 농장 삭제
    
    **[POST /delFarm]**
    
    - **설명:**
        - 사용자가 선택한 스마트팜 및 관련 장치를 삭제하는 API입니다.
    - **요청 파라미터:**
        - `farm_ids`: 삭제할 농장 ID 배열

---

### 실시간 데이터 불러오기 (1시간 단위 평균)

**[GET /realtime-data]**

- **설명:**
    - 사용자가 특정 농장의 실시간 데이터(1시간 단위 평균값)를 불러오는 API입니다. 온도, 습도, 토양 수분, CO2 농도의 평균값을 1시간 간격으로 반환합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        [
          {
            "time_interval": "2025-02-27 12:00:00",
            "avg_temperature": 24.5,
            "avg_humidity": 65,
            "avg_soil_moisture": 42,
            "avg_co2": 350
          },
          {
            "time_interval": "2025-02-27 13:00:00",
            "avg_temperature": 25.0,
            "avg_humidity": 60,
            "avg_soil_moisture": 43,
            "avg_co2": 340
          }
        ]
        ```
        

---

### 기록 데이터 API (날짜별 센서 데이터)

**[GET /history-data]**

- **설명:**
    - 사용자가 특정 농장에 대한 날짜별 기록된 센서 데이터를 불러오는 API입니다. 날짜를 기준으로 1시간 단위로 평균값을 계산하여 반환합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `date`: 조회할 날짜 (YYYY-MM-DD 형식)
- **응답**
    - 성공 `200`
        
        ```json
        [
          {
            "time_interval": "2025-02-27 00:00:00",
            "avg_temperature": 22.3,
            "avg_humidity": 63,
            "avg_soil_moisture": 45,
            "avg_co2": 300
          },
          {
            "time_interval": "2025-02-27 01:00:00",
            "avg_temperature": 23.0,
            "avg_humidity": 62,
            "avg_soil_moisture": 46,
            "avg_co2": 310
          }
        ]
        ```
        

---

### 사용자 이름 불러오기

**[GET /getName]**

- **설명:**
    - 사용자의 ID를 통해 사용자 이름을 불러오는 API입니다.
- **요청 파라미터:**
    - `user_id`: 사용자 ID
- **응답**
    - 성공 `200`
        
        ```json
        {
          "username": "김태우"
        }
        ```
        

---

### 스마트팜 이름 불러오기

**[GET /getFarmName]**

- **설명:**
    - 사용자의 ID를 통해 스마트팜의 이름을 불러오는 API입니다.
- **요청 파라미터:**
    - `user_id`: 사용자 ID (고유 값)
- **응답**
    - 성공 `200`
        
        ```json
        {
          "farmname": "김태우의 스마트팜"
        }
        ```
        

---

---

### 날짜별 센서 데이터 조회

**[GET /sensors/data]**

- **설명:**
    
    특정 날짜의 센서 데이터를 조회하는 엔드포인트입니다. 조회된 데이터는 시간순으로 정렬됩니다.
    
- **요청 파라미터:**
    - `date`: 조회할 날짜 (형식: 'YYYY-MM-DD')
    - `userId`: 사용자 이메일
    - `farmId`: 농장 ID
- **응답:**
    - 성공 `200`
        
        ```json
        [
          {
            "temperature": 22.25,
            "humidity": 75.40,
            "soil_moisture": 50.32,
            "co2": 400.55,
            "created_at": "2025-02-25T19:00:00+09:00"
          },
          ...
        ]
        ```
        

---

### 통계 데이터 조회

**[GET /sensors/average]**

- **설명:**
    - 특정 기간 동안의 센서 데이터 평균 값을 조회하는 엔드포인트입니다. 일별, 주별, 월별로 통계를 제공합니다.
- **요청 파라미터:**
    - `type`: 통계 종류 (`day`, `week`, `month`)
    - `userId`: 사용자 이메일
    - `farmId`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        [
          {
            "period": "2025-02-25",
            "avg_temperature": 22.5,
            "avg_humidity": 75.0,
            "avg_soil_moisture": 50.0
          },
          ...
        ]
        ```