# API 정리

날짜: 2025년 2월 25일
선택: 서버

### 로그인 페이지

**[GET /login]**

- **설명:**
    - 클라이언트가 로그인 페이지(`login.html`)를 요청하는 엔드포인트입니다. 주로 웹 브라우저에서 로그인 화면을 표시하는 데 사용됩니다.
- **응답:** HTML 페이지

---

### 아이디 중복 확인

**[GET /check-userid]**

- **설명:**
    - 사용자가 입력한 아이디(user_id)가 이미 존재하는지 확인합니다.
- **요청 파라미터:**
    - `user_id`: 중복 확인할 사용자 이메일
- **응답:**
    - **성공 (**사용 가능한 아이디) **`200`**
        
        ```json
        {
          "message": "사용 가능한 아이디입니다."
        }
        ```
        
    - **실패 (**이미 사용 중인 아이디) **`400`**
        
        ```json
        {
          "message": "이미 사용 중인 아이디입니다."
        }
        ```
        
    - **실패 (**서버 오류) **`500`**
        
        ```json
        {
          "message": "서버 오류"
        }
        ```
        

---

### 닉네임 중복 확인

**[GET /check-username]**

- **설명:**
    - 사용자가 입력한 닉네임(username)이 이미 존재하는지 확인합니다.
- **요청 파라미터:**
    - `username`: 중복 확인할 사용자 닉네임
- **응답:**
    - **성공 (**사용 가능한 닉네임) **`200`**
        
        ```json
        {
          "message": "사용 가능한 닉네임입니다."
        }
        ```
        
    - **실패 (**이미 사용 중인 닉네임) **`400`**
        
        ```json
        {
          "message": "이미 사용 중인 닉네임입니다."
        }
        ```
        
    - **실패 (**서버 오류) **`500`**
        
        ```json
        {
          "message": "서버 오류"
        }
        ```
        

---

### 3. 회원가입

**[POST /signup]**

- **설명:**
    - 사용자가 새로운 계정을 생성하는 엔드포인트입니다. 이메일(user_id), 비밀번호(password), 사용자 이름(username)을 받아 회원가입을 처리합니다.
- **요청 파라미터:**
    - `user_id`: 회원가입할 ID
    - `password`:  회원가입할 비밀번호
    - `username`:  회원가입할 닉네임
- **응답:**
    - **성공 (**회원가입 성공) **`201`**
        
        ```json
        {
          "message": "회원가입 성공"
        }
        ```
        
    - **실패 (**이미 존재하는 이메일) **`400`**
        
        ```json
        {
          "message": "이미 존재하는 이메일입니다."
        }
        ```
        
    - **실패 (**서버 오류) **`500`**
        
        ```json
        {
          "message": "회원가입 실패"
        }
        ```
        

---

### 로그인

**[POST /login]**

- **설명:**
    - 사용자가 기존 계정으로 로그인하는 엔드포인트입니다. 이메일과 비밀번호를 확인하여 인증을 진행합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `password`: 비밀번호
- **응답**
    - 성공 `200`
        
        ```json
        {
          "message": "로그인 성공",
          "token": "some-jwt-token"
        }
        ```
        
    - 실패 (존재하지 않는 이메일) `401`
        
        ```json
        {
          "message": "존재하지 않는 이메일입니다."
        }
        ```
        
    - 실패 (잘못된 비밀번호) `401`
        
        ```json
        {
          "message": "잘못된 비밀번호입니다."
        }
        ```
        

---

### 최근 센서 데이터 조회

**[GET /sensors/status]**

- **설명:**
    - 특정 사용자와 농장에 대한 최신 센서 데이터를 조회합니다. 온도, 습도, 토양 수분 등의 정보를 반환합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        {
          "temperature": 22.25,
          "humidity": 75.40,
          "soil_moisture": 50.32,
          "created_at": "2025-02-25T10:00:00Z"
        }
        ```
        
    - 실패 (필드 누락) `400`
        
        ```json
        {
          "message": "user_id와 farm_id가 필요합니다."
        }
        ```
        
    - 실패 (조회된 데이터 없음) `404`
        
        ```json
        {
          "message": "해당 조건에 맞는 데이터가 없습니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "message": "DB 오류 발생"
        }
        ```
        

---

### 센서 데이터 저장 (온도, 습도, 토양 수분)

**[POST /sensors]**

- **설명:**
    - 센서에서 수집된 데이터를 저장하는 엔드포인트입니다. 온도, 습도, 토양 수분 값을 수집하여 DB에 저장합니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `temperature`: 온도
    - `humidity`: 습도
    - `soil_moisture`: 토양 수분
- **응답**
    - 성공 `200`
        
        ```json
        {
          "message": "센서 데이터 저장 성공"
        }
        ```
        
    - 실패 (필드 누락) `400`
        
        ```json
        {
          "message": "모든 파라미터를 채워주세요."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "message": "데이터 저장 오류 발생"
        }
        ```
        

---

### 제어장치 상태 가져오기

**[GET /devices/status]**

- **설명:**
    - 특정 농장에 있는 제어장치들(LED, 팬, 물 공급)의 상태를 조회하는 엔드포인트입니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        {
          "led": true,
          "fan": false,
          "water": true
        }
        ```
        
    - 실패 (필드 누락) `400`
        
        ```json
        {
          "message": "user_id와 farm_id가 필요합니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "message": "DB 오류 발생"
        }
        ```
        

---

### 제어장치 상태 변경하기

**[POST /devices/status]**

- **설명:**
    - 농장의 제어장치(LED, 팬, 물 공급)의 상태를 변경하는 엔드포인트입니다. 각 장치를 켜거나 끌 수 있습니다.
- **요청 파라미터:**
    - `user_id`: 사용자 이메일
    - `farm_id`: 농장 ID
    - `device`: 장치 타입 (`led`, `fan`, `water`)
- **응답**
    - 성공 `200`
        
        ```json
        {
          "message": "장치 상태 변경 성공",
          "led": false,
          "fan": false,
          "water": true
        }
        ```
        
    - 실패 (필드 누락) `400`
        
        ```json
        {
          "message": "user_id, farm_id, device가 필요합니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "message": "DB 오류 발생"
        }
        ```
        
    - 실패 (상태 조회 오류) `500`
        
        ```json
        {
          "message": "상태 조회 오류 발생"
        }
        ```
        

---

### 시간대별 데이터 조회

**[GET /sensors/data]**

- **설명:**
    - 특정 기간 동안의 센서 데이터를 조회하는 엔드포인트입니다. 날짜 범위에 맞는 데이터를 반환합니다.
- **요청 파라미터:**
    - `startDate`: 시작 날짜 (형식: 'YYYY-MM-DD')
    - `endDate`: 종료 날짜 (형식: 'YYYY-MM-DD')
    - `userId`: 사용자 이메일
    - `farmId`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        [
          {
            "temperature": 22.25,
            "humidity": 75.40,
            "soil_moisture": 50.32,
            "created_at": "2025-02-25T10:00:00Z",
            "created_at_kst": "2025-02-25T19:00:00Z"
          },
          ...
        ]
        ```
        
    - 실패 (파라미터 누락) `400`
        
        ```json
        {
          "error": "startDate, endDate, userId, farmId가 필요합니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "error": "DB 오류 발생"
        }
        ```
        

---

### 통계 데이터 조회

**[GET /sensors/average]**

- **설명:**
    - 특정 기간 동안의 센서 데이터 평균 값을 조회하는 엔드포인트입니다. 일별, 주별, 월별로 통계를 제공합니다.
- **요청 파라미터:**
    - `type`: 통계 종류 (`day`, `week`, `month`)
    - `userId`: 사용자 이메일
    - `farmId`: 농장 ID
- **응답**
    - 성공 `200`
        
        ```json
        [
          {
            "period": "2025-02-25",
            "avg_temperature": 22.5,
            "avg_humidity": 75.0,
            "avg_soil_moisture": 50.0
          },
          ...
        ]
        ```
        
    - 실패 (유효하지 않은 `type`) `400`
        
        ```json
        {
          "error": "유효하지 않은 type 파라미터입니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "error": "DB 오류 발생"
        }
        ```
        

---

### 농장 목록 불러오기

**[GET /getFarms]**

- **설명:**
    - 사용자가 보유한 농장의 목록을 불러오는 엔드포인트입니다. 농장의 ID와 이름이 반환됩니다.
- **요청 파라미터:**
    - `userId`: 사용자 이메일
- **응답**
    - 성공 `200`
        
        ```json
        {
          "success": true,
          "farms": [
            {
              "farm_id": 1,
              "farm_name": "농장 A"
            },
            {
              "farm_id": 2,
              "farm_name": "농장 B"
            }
          ]
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "success": false,
          "message": "DB 오류 발생"
        }
        ```
        

---

### 농장 추가하기

**[POST /addFarm]**

- **설명:**
    - 사용자가 새로운 농장을 추가하는 엔드포인트입니다. 농장 이름을 받아서 새로운 농장을 등록합니다.
- **요청 파라미터 (JSON):**
    - `userId`: 사용자 이메일
- **응답**
    - 성공 `200`
        
        ```json
        {
          "success": true,
          "farm_id": 1
        }
        ```
        
    - 실패 (파라미터 누락) `400`
        
        ```json
        {
          "success": false,
          "message": "userId가 누락되었습니다."
        }
        ```
        
    - 실패 (DB 오류) `500`
        
        ```json
        {
          "success": false,
          "message": "DB 오류 발생"
        }
        ```